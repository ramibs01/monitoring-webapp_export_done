{% extends "base.html" %}

{% block title %}Add Planned Dedication | KPIT Monitoring Tool{% endblock %}
{% block page_title %}Add Planned Dedication{% endblock %}

{% block content %}
<div class="form-container">
  <h2>Add Planned Dedication</h2>

  <form method="post" id="dedication-form">
    {% csrf_token %}

    <div class="form-group">
      <label for="user">Select User</label>
      <select name="user" id="user" class="form-control" required>
        <option value="">-- Select User --</option>
        {% for u in users %}
          <option value="{{ u.id }}">{{ u.username }}</option>
        {% endfor %}
      </select>
    </div>

    <div id="projects-container">
      <!-- Project blocks will be added here -->
    </div>

    <button type="button" id="add-project-btn" class="btn-add-project">‚ûï Add Project</button>

    <div class="button-group">
      <button type="submit" class="btn-submit">üíæ Save All</button>
      <a href="{% url 'planned_dedication_list' %}" class="btn-cancel">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
const projectsContainer = document.getElementById('projects-container');
const addProjectBtn = document.getElementById('add-project-btn');
let projectCount = 0;

// Function to create a new project block
function addProjectBlock() {
  const block = document.createElement('div');
  block.classList.add('project-block');
  block.dataset.index = projectCount;

  // Build table rows for vertical months
  let monthRows = '';
  {% for m in months %}
    monthRows += `
      <tr>
        <td>{{ m.month }}</td>
        <td>
          <input type="number" name="dedication_${projectCount}_{{ m.id }}" min="0" max="100" class="form-control" required>
        </td>
      </tr>
    `;
  {% endfor %}

  block.innerHTML = `
    <h3>Project ${projectCount + 1}</h3>
    <div class="form-group">
      <label>Select Project</label>
      <select name="project_${projectCount}" class="form-control" required>
        <option value="">-- Select Project --</option>
        {% for p in all_projects %}
          <option value="{{ p.id }}">{{ p.name }}</option>
        {% endfor %}
      </select>
    </div>
    <table class="dedication-table">
      <thead>
        <tr>
          <th>Month</th>
          <th>Planned Dedication (%)</th>
        </tr>
      </thead>
      <tbody>
        ${monthRows}
      </tbody>
    </table>
    <button type="button" class="btn-remove-project">üóëÔ∏è Remove Project</button>
  `;

  projectsContainer.appendChild(block);

  // Remove project button
  block.querySelector('.btn-remove-project').addEventListener('click', () => {
    block.remove();
  });

  projectCount++;
}

// Add initial project block
addProjectBlock();

// Add more project blocks dynamically
addProjectBtn.addEventListener('click', addProjectBlock);
</script>
{% endblock %}

{% block extra_css %}
<style>
.form-container {
    max-width: 900px;
    margin: 50px auto;
    padding: 30px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    font-family: "Segoe UI", sans-serif;
}
.form-container h2 { text-align: center; margin-bottom: 25px; font-size: 26px; color: #243b55; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #333; }
.form-control { width: 100%; padding: 10px 12px; font-size: 15px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
.button-group { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
.btn-submit { background: #00b894; color: #fff; padding: 10px 24px; font-weight: 600; border-radius: 6px; border: none; cursor: pointer; }
.btn-submit:hover { background: #019172; }
.btn-cancel { background: #d63031; color: #fff; padding: 10px 24px; font-weight: 600; border-radius: 6px; text-decoration: none; display: inline-block; }
.btn-cancel:hover { background: #c0392b; }

.project-block { padding: 20px; margin-bottom: 25px; border: 1px solid #e0e0e0; border-radius: 10px; background: #f9f9f9; position: relative; }
.project-block h3 { margin-bottom: 15px; color: #0984e3; font-size: 20px; }
.btn-add-project { background: #0984e3; color: #fff; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; margin-bottom: 20px; }
.btn-add-project:hover { background: #0652dd; }
.btn-remove-project { background: #d63031; color: #fff; padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; margin-top: 10px; }
.btn-remove-project:hover { background: #c0392b; }

/* Vertical months table */
.dedication-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

.dedication-table th,
.dedication-table td {
  padding: 8px 12px;
  border: 1px solid #ccc;
  font-size: 14px;
}

.dedication-table th {
  background-color: #00b894;
  color: #fff;
  font-weight: 600;
  text-align: left;
}

.dedication-table td {
  text-align: left;
}

.dedication-table td input {
  width: 80px;
  padding: 6px 8px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-align: center;
}
</style>
{% endblock %}
