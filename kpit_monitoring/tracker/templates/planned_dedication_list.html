{% extends "base.html" %}

{% block title %}Planned Dedications | KPIT Monitoring Tool{% endblock %}
{% block page_title %}Planned Dedications{% endblock %}

{% block content %}
<div class="dashboard-container">

  <!-- Success messages -->
  {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="alert {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <h2>Planned Dedications</h2>

  <!-- Buttons -->
  <div class="btn-container">
    <a href="{% url 'add_planned_dedication' %}" class="btn-enter">‚ûï Add Resource Dedication</a>
    <a href="{% url 'export_monthly_dedication' %}" class="btn-enter">‚¨áÔ∏è Export Monthly Dedication</a>
    <a href="{% url 'export_overview_excel' %}" class="btn-enter">üìä Export Overview Excel</a>
  </div>

  <!-- Filter Form -->
  <form method="get" class="filter-form">
    <select name="month">
      <option value="">-- Filter by Month --</option>
      {% for m in months %}
        <option value="{{ m.id }}" {% if request.GET.month == m.id|stringformat:"s" %}selected{% endif %}>{{ m.month }}</option>
      {% endfor %}
    </select>

    <select name="user">
      <option value="">-- Filter by User --</option>
      {% for u in users %}
        <option value="{{ u.id }}" {% if request.GET.user == u.id|stringformat:"s" %}selected{% endif %}>{{ u.username }}</option>
      {% endfor %}
    </select>

    <select name="project">
      <option value="">-- Filter by Project --</option>
      {% for p in projects %}
        <option value="{{ p.id }}" {% if request.GET.project == p.id|stringformat:"s" %}selected{% endif %}>{{ p.name }}</option>
      {% endfor %}
    </select>

    <input type="number" name="dedication" placeholder="Dedication %" value="{{ request.GET.dedication }}">

    <button type="submit" class="btn-filter">Filter</button>
    <a href="{% url 'planned_dedication_list' %}" class="btn-clear">Clear</a>
  </form>

  <!-- Table with scroll -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>User ID</th>
          <th>Project</th>
          <th>Project ID</th>
          <th>Month</th>
          <th>Planned Dedication</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if dedications %}
          {% for d in dedications %}
            <tr>
              <td>{{ d.user.username }}</td>
              <td>{{ d.user.id }}</td>
              <td>{{ d.project.name }}</td>
              <td>{{ d.project.id }}</td>
              <td>{{ d.month.month }}</td>
              <td>{{ d.planned_dedication }}</td>
              <td>
                <a href="{% url 'edit_planned_dedication' d.id %}" class="btn-edit">‚úèÔ∏è Edit</a>
                <a href="{% url 'delete_planned_dedication' d.id %}" 
                   class="btn-delete"
                   onclick="return confirm('Are you sure you want to delete this planned dedication?');">
                   üóëÔ∏è Delete
                </a>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7" class="no-data">No planned dedications found.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.dashboard-container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 25px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 20px;
}

h2 { text-align: center; margin-bottom: 10px; color: #2c3e50; }

.btn-container { display: flex; justify-content: flex-end; gap: 10px; }

.btn-enter {
    padding: 10px 18px; background: #00b894; color: #fff; border-radius: 8px;
    text-decoration: none; font-weight: bold; transition: background 0.2s;
}
.btn-enter:hover { background: #019875; }

.filter-form {
    display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; align-items: center;
}
.filter-form select, .filter-form input {
    padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc;
}
.btn-filter { background: #00b894; color: white; padding: 6px 14px; border: none; border-radius: 4px; cursor: pointer; }
.btn-filter:hover { background: #019172; }
.btn-clear { padding: 6px 14px; background: #eee; border-radius: 4px; text-decoration: none; color: #555; }
.btn-clear:hover { background: #ddd; }

.table-container { overflow-x: auto; overflow-y: auto; max-height: 400px; border: 1px solid #e0e0e0; border-radius: 6px; }
.table-container thead th { position: sticky; top: 0; background: #f8f9fa; z-index: 2; font-weight: bold; text-transform: uppercase; }

table { width: 100%; border-collapse: collapse; min-width: 800px; }
th, td { padding: 10px 12px; border: 1px solid #e0e0e0; text-align: center; }
tr:nth-child(even) { background: #fafafa; }
.no-data { text-align: center; color: #888; font-style: italic; padding: 15px 0; }

.messages .alert { padding: 10px 15px; margin: 10px 0; border-radius: 6px; color: #fff; background: #00b894; }
.btn-edit { padding: 6px 10px; border-radius: 6px; text-decoration: none; font-size: 13px; margin: 0 3px; display: inline-block; background: #3498db; color: #fff; }
.btn-edit:hover { background: #217dbb; }
.btn-delete { padding: 6px 10px; border-radius: 6px; text-decoration: none; font-size: 13px; margin: 0 3px; display: inline-block; background: #e74c3c; color: #fff; }
.btn-delete:hover { background: #c0392b; }
</style>
{% endblock %}
